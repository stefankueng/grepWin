<?xml version="1.0" encoding="Windows-1252"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- This gets automatically generated by the makefile running SubWCRev.exe on VersionNumberInclude.in.wxi -->
  <?include VersionNumberInclude.wxi ?>
  <Product
    UpgradeCode="C8EC878C-5B8A-4208-9670-64313B180089"
    Name="grepWin"
    Id="*"
    Language="1033"
    Codepage="1252"
    Version="$(var.MajorVersion).$(var.MinorVersion).$(var.BuildVersion)"
    Manufacturer="Stefans Tools">

    <Package Id="*"
             Keywords="Installer"
             Description="Stefans grepWin"
             Comments="http://tools.stefankueng.com"
             Manufacturer="Stefans Tools"
             InstallerVersion="200"
             Languages="1033"
             Compressed="yes"
             SummaryCodepage="1252" />

    <Upgrade Id="C8EC878C-5B8A-4208-9670-64313B180089" >
      <!-- flag is set if the install will trigger an upgrade of an existing install -->
      <UpgradeVersion Property="PREVIOUSVERSIONSINSTALLED" Maximum="$(var.MajorVersion).$(var.MinorVersion).$(var.BuildVersion)" IncludeMaximum="no" />
    </Upgrade>

    <Media Id="1" Cabinet="grepWin.cab" EmbedCab="yes" CompressionLevel="high" />
    <Icon Id="grepWinIcon" SourceFile="..\Resources\grepWin.ico" />
    <Property Id="ARPPRODUCTICON">grepWinIcon</Property>
    <Condition Message="This application only runs on Windows 7 and later.">
      <![CDATA[Installed OR (VersionNT >= 601)]]>
    </Condition>

    <Property Id="ApplicationFolderName" Value="grepWin" />

        <!-- This property sets the default selected value of the radio button 
         on the install scope dialog in the setup UI where the user can choose 
         whether to install the product per-machine or per-user. -->
    <Property Id='WixAppFolder' Value='WixPerUserFolder' />
    <!--Property Id='WixAppFolder' Value='WixPerMachineFolder' /-->

    <Property Id="APPLICATIONFOLDER" Secure="yes">
      <RegistrySearch Id="FindInstallLocation"
                      Root="HKLM"
                      Key="Software\Microsoft\Windows\CurrentVersion\Uninstall\[WIX_UPGRADE_DETECTED]"
                      Name="InstallLocation"
                      Type="raw"/>
    </Property>

    <!-- Fix for WixUI_Advanced to set properties correctly -->
    <Property Id='ALLUSERS' Value='2' />
    <Property Id='MSIINSTALLPERUSER' Value='1'/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="APPLICATIONFOLDER" Name="grepWin">

          <Component Id="MainEXE" Guid="A9818B4B-B626-4455-AA31-588EAFAFA213">
            <File Id="grepWin.EXE" Name="grepWin.exe" DiskId="1" Source="../../bin/release/grepWin.exe" Vital="yes" />
            <File Id="German.lang" Name="German.lang" DiskId="1" Source="../../translations/German.lang" />
            <File Id="Chinese.lang" Name="Chinese.lang" DiskId="1" Source="../../translations/Chinese.lang" />
            <File Id="Japanese.lang" Name="Japanese.lang" DiskId="1" Source="../../translations/Japanese.lang" />
            <File Id="Dutch.lang" Name="Dutch.lang" DiskId="1" Source="../../translations/Dutch.lang" />
            <File Id="Polish.lang" Name="Polish.lang" DiskId="1" Source="../../translations/Polish.lang" />
            <File Id="Spanish.lang" Name="Spanish.lang" DiskId="1" Source="../../translations/Spanish.lang" />
            <File Id="Italian.lang" Name="Italian.lang" DiskId="1" Source="../../translations/Italian.lang" />
            <File Id="Portuguese_Brazilian.lang" Name="Portuguese Brazilian.lang" DiskId="1" Source="../../translations/Portuguese Brazilian.lang" />
            <File Id="French.lang" Name="French.lang" DiskId="1" Source="../../translations/French.lang" />
            <File Id="Turkish.lang" Name="Turkish.lang" DiskId="1" Source="../../translations/Turkish.lang" />
            <File Id="Russian.lang" Name="Russian.lang" DiskId="1" Source="../../translations/Russian.lang" />
            <File Id="Greek.lang" Name="Greek.lang" DiskId="1" Source="../../translations/Greek.lang" />
            <File Id="Belarusian.lang" Name="Belarusian.lang" DiskId="1" Source="../../translations/Belarusian.lang" />
            <File Id="Hungarian.lang" Name="Hungarian.lang" DiskId="1" Source="../../translations/Hungarian.lang" />
            <File Id="Portuguese.lang" Name="Portuguese.lang" DiskId="1" Source="../../translations/Portuguese.lang" />
            <File Id="Slovak.lang" Name="Slovak.lang" DiskId="1" Source="../../translations/Slovak.lang" />
            <File Id="Swedish.lang" Name="Swedish.lang" DiskId="1" Source="../../translations/Swedish.lang" />
            <File Id="Afrikaans.lang" Name="Afrikaans.lang" DiskId="1" Source="../../translations/Afrikaans.lang" />
            <File Id="Korean.lang" Name="Korean.lang" DiskId="1" Source="../../translations/Korean.lang" />
            <File Id="Spanish_Mexican.lang" Name="Spanish Mexican.lang" DiskId="1" Source="../../translations/Spanish Mexican.lang" />
            <File Id="Hindi.lang" Name="Hindi.lang" DiskId="1" Source="../../translations/Hindi.lang" />
            <RegistryKey Root="HKMU" Key="Software\Classes\Directory\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%1"' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Classes\Directory\Background\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\Background\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\Background\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Directory\Background\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%V"' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Classes\LibraryFolder\background\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\LibraryFolder\background\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\LibraryFolder\background\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\LibraryFolder\background\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%V"' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Classes\Folder\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Folder\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Folder\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Folder\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%1"' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Classes\Drive\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Drive\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Drive\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\Drive\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%1"' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Classes\*\shell\grepWin" />
            <RegistryValue Root="HKMU" Key="Software\Classes\*\shell\grepWin" Value="Search with grepWin" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\*\shell\grepWin" Name="Icon" Value='[APPLICATIONFOLDER]grepWin.exe,-107' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\*\shell\grepWin\command" Value='"[APPLICATIONFOLDER]grepWin.exe" /searchpath:"%1"' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Classes\*\shell\grepWin" Name="MultiSelectModel" Value='Player' Type="string" />
            <RegistryValue Root="HKMU" Key="Software\grepWin" Name="APPLICATIONFOLDER" Value='[APPLICATIONFOLDER]' Type="string" />
            <RegistryKey Root="HKMU" Key="Software\Microsoft\Windows\CurrentVersion\App Paths\grepWin.exe" />
            <RegistryValue Root="HKMU" Key="Software\Microsoft\Windows\CurrentVersion\App Paths\grepWin.exe" Name="Path" Value="[APPLICATIONFOLDER]" Type="string" />
            <RegistryValue Root="HKMU" Key="Software\Microsoft\Windows\CurrentVersion\App Paths\grepWin.exe" Value="[APPLICATIONFOLDER]grepWin.exe" Type="string" />
          </Component>

        </Directory>
        <Directory Id="ProgramMenuFolder" Name="Programs">
          <Directory Id="ProgramMenuDir" Name="grepWin" />
        </Directory>
      </Directory>

    </Directory>
    <DirectoryRef Id="ProgramMenuDir">
      <Component Id="StartMenuShortCut" Guid="83F25E6F-0EE0-4ca8-BF92-FCAD9709037E">
        <Shortcut Id="startMenugrepWin" Directory="ProgramMenuDir" Name="grepWin" Target="[APPLICATIONFOLDER]grepWin.exe" Description="regular expression search" />
        <RemoveFolder Id="ProgramMenuDir" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\grepWin" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Feature Id="Complete" Title="grepWin" Description="The complete package."
          Display="expand" Level="1" ConfigurableDirectory="APPLICATIONFOLDER">
      <Feature Id="MainEXE" Title="Program" Description="The main executable." Level="1">
        <ComponentRef Id="MainEXE" />
        <ComponentRef Id="StartMenuShortCut" />
      </Feature>
    </Feature>

    <UIRef Id='WixUI_ErrorProgressText' />
    <UIRef Id="WixUI_Advanced" />
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="Banner.jpg" />
    <WixVariable Id="WixUIDialogBmp" Value="Dialog.jpg" />

    <!-- Workaround Wix Bug: https://github.com/wixtoolset/issues/issues/2165 -->
    <UI>
      <UIRef Id="WixUI_Advanced" />
      <Publish Dialog="InstallDirDlg" Control="Next" Event="DoAction" Value="FindRelatedProducts">1</Publish>
      <Publish Dialog="InstallScopeDlg" Control="Next" Property="MSIINSTALLPERUSER" Value="1" Order="3">WixAppFolder = "WixPerUserFolder"</Publish>
      <Publish Dialog="InstallScopeDlg" Control="Next" Property="MSIINSTALLPERUSER" Value="{}" Order="2">WixAppFolder = "WixPerMachineFolder"</Publish>
      <Publish Dialog="InstallScopeDlg" Control="Next" Event="DoAction" Value="Overwrite_WixSetDefaultPerMachineFolder" Order="3">WixAppFolder = "WixPerMachineFolder"</Publish>
      <Publish Dialog="InstallScopeDlg" Control="Next" Event="DoAction" Value="Overwrite_WixSetDefaultPerUserFolder" Order="3">WixAppFolder = "WixPerUserFolder"</Publish>
    </UI>

    <CustomAction Id="Overwrite_WixSetDefaultPerMachineFolder"
                  Property="WixPerMachineFolder" Value="[ProgramFilesFolder][ApplicationFolderName]"
                  Execute="immediate" />
    <CustomAction Id="Overwrite_WixSetDefaultPerUserFolder"
                  Property="WixSetDefaultPerUserFolder" Value="[LocalAppDataFolder]\Programs\[ApplicationFolderName]"
                  Execute="immediate" />
    <InstallUISequence>
      <Custom Action="Overwrite_WixSetDefaultPerMachineFolder" After="WixSetDefaultPerMachineFolder" />
    </InstallUISequence>
    <InstallExecuteSequence>
      <Custom Action="Overwrite_WixSetDefaultPerMachineFolder" After="WixSetDefaultPerMachineFolder" />
    </InstallExecuteSequence>

    <SetProperty Id="ARPINSTALLLOCATION" Value="[APPLICATIONFOLDER]" After="CostFinalize" />

    <InstallExecuteSequence>
      <AppSearch Sequence="1"></AppSearch>
      <LaunchConditions After="AppSearch" />
      <RemoveExistingProducts After="InstallValidate"><![CDATA[PREVIOUSVERSIONSINSTALLED]]></RemoveExistingProducts>
    </InstallExecuteSequence>

  </Product>
</Wix>
